<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Prompt 生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        textarea:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
            border-color: rgb(59 130 246);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-xl custom-shadow p-6 md:p-8">
        <div class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Prompt 生成器</h1>
            <p class="text-gray-500 mt-2">输入提示词和RAG参考资料，添加条目后可一次性下载两个Prompt文件。</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label for="prompt-input" class="block text-sm font-medium text-gray-700 mb-2">1. 输入核心提示词 (第一块内容)</label>
                <textarea id="prompt-input" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none transition duration-200" placeholder="例如：一只猫在沙发上睡觉。"></textarea>
            </div>
            <div>
                <label for="rag-input" class="block text-sm font-medium text-gray-700 mb-2">2. 输入RAG检索资料 (第二块内容)</label>
                <textarea id="rag-input" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none transition duration-200" placeholder="例如：沙发是棕色的，猫是橘色的。"></textarea>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6">
            <button id="add-entry" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 custom-shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                添加条目
            </button>
        </div>
        
        <div id="status-message" class="text-center text-green-600 font-medium h-6 mb-4"></div>

        <div class="bg-gray-100 p-4 rounded-lg">
            <h3 class="font-semibold text-lg mb-2 text-gray-800">已添加内容预览 (<span id="entry-count">0</span> 条)</h3>
            <div class="flex justify-end mb-2">
                <button id="clear-data" class="text-sm text-red-500 hover:text-red-700 font-medium">清空所有</button>
            </div>
            <div class="max-h-48 overflow-y-auto bg-white border border-gray-200 rounded-md p-3">
                <pre id="preview-area" class="text-sm text-gray-600 whitespace-pre-wrap break-words"></pre>
            </div>
        </div>

        <div class="mt-8 border-t pt-6 text-center">
             <p class="text-gray-500 mb-4">完成所有条目添加后，点击下方按钮下载文件。</p>
            <button id="download-files" class="w-full sm:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition duration-300 custom-shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                下载 Prompt 文件
            </button>
        </div>
    </div>

    <script>
        // DOM 元素获取
        const promptInput = document.getElementById('prompt-input');
        const ragInput = document.getElementById('rag-input');
        const addEntryBtn = document.getElementById('add-entry');
        const downloadBtn = document.getElementById('download-files');
        const clearBtn = document.getElementById('clear-data');
        const statusMessage = document.getElementById('status-message');
        const previewArea = document.getElementById('preview-area');
        const entryCount = document.getElementById('entry-count');

        // 初始化数据存储
        let basePromptContent = '';
        let ragPromptContent = '';
        let entries = 0;

        // 更新预览和UI状态
        function updateUI() {
            previewArea.textContent = ragPromptContent || '暂无内容...';
            entryCount.textContent = entries;
            if (entries > 0) {
                downloadBtn.disabled = false;
            } else {
                downloadBtn.disabled = true;
            }
        }

        // 添加条目按钮事件
        addEntryBtn.addEventListener('click', () => {
            const promptText = promptInput.value.trim();
            const ragText = ragInput.value.trim();

            if (!promptText) {
                statusMessage.textContent = '核心提示词不能为空！';
                statusMessage.classList.remove('text-green-600');
                statusMessage.classList.add('text-red-600');
                setTimeout(() => statusMessage.textContent = '', 3000);
                return;
            }
            
            // 清理输入中的换行符
            const cleanedPrompt = promptText.replace(/[\r\n]+/g, ' ');
            const cleanedRag = ragText.replace(/[\r\n]+/g, ' ');

            // 格式化基础 prompt
            const baseEntry = `positive: ${cleanedPrompt}\nnegative: 1\n-----------------\n`;
            
            // 格式化 RAG prompt
            let ragEntry;
            if (cleanedRag) {
                ragEntry = `positive: ${cleanedPrompt}    RAG检索参考资料：${cleanedRag}\nnegative: 1\n-----------------\n`;
            } else {
                // 如果 RAG 为空，则与基础 prompt 相同
                ragEntry = baseEntry;
            }

            // 追加到累积内容中
            basePromptContent += baseEntry;
            ragPromptContent += ragEntry;
            entries++;

            // 更新UI
            updateUI();
            
            // 清空输入框
            promptInput.value = '';
            ragInput.value = '';
            promptInput.focus();

            // 显示成功消息
            statusMessage.textContent = '条目添加成功！';
            statusMessage.classList.remove('text-red-600');
            statusMessage.classList.add('text-green-600');
            setTimeout(() => statusMessage.textContent = '', 2000);
        });

        // 下载文件函数
        function downloadFile(filename, content) {
            const element = document.createElement('a');
            const file = new Blob([content], {type: 'text/plain;charset=utf-8'});
            element.href = URL.createObjectURL(file);
            element.download = filename;
            document.body.appendChild(element); // Required for this to work in FireFox
            element.click();
            document.body.removeChild(element);
        }

        // 下载按钮事件
        downloadBtn.addEventListener('click', () => {
            if (entries === 0) {
                statusMessage.textContent = '没有可下载的内容！';
                statusMessage.classList.remove('text-green-600');
                statusMessage.classList.add('text-red-600');
                setTimeout(() => statusMessage.textContent = '', 3000);
                return;
            }
            downloadFile('基础prompt.txt', basePromptContent);
            downloadFile('RAG_prompt.txt', ragPromptContent);
        });
        
        // 清空数据按钮事件
        clearBtn.addEventListener('click', () => {
            if (confirm('确定要清空所有已添加的内容吗？此操作不可撤销。')) {
                basePromptContent = '';
                ragPromptContent = '';
                entries = 0;
                updateUI();
                statusMessage.textContent = '所有内容已清空。';
                statusMessage.classList.remove('text-red-600');
                statusMessage.classList.add('text-green-600');
                setTimeout(() => statusMessage.textContent = '', 2000);
            }
        });

        // 初始化UI
        updateUI();
    </script>
</body>
</html>
